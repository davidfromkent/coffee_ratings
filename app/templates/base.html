<!DOCTYPE html>
{% import "cup_macros.html" as cups %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ title if title else "Coffee Ratings" }}</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Favicon -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/static/img/dfd_logo_64.png">

    <link rel="manifest" href="/static/manifest.json">
</head>

<body class="min-h-screen bg-[#4b3621] flex justify-center overflow-x-hidden">
    <div class="w-full max-w-md px-4 pb-10 overflow-x-hidden">

        <!-- Top nav -->
        <div class="flex items-center justify-between mt-6 mb-6">
            <a href="/" class="text-[#f7f2e9] font-bold text-lg">Coffee Ratings</a>

            <div class="flex gap-4 text-sm">
                <a href="/venues" class="text-[#e8dfd1] hover:text-white">Venues</a>
                <a href="/reviews" class="text-[#e8dfd1] hover:text-white">Reviews</a>
                <a href="/reviews/new" class="text-[#e8dfd1] hover:text-white">Add</a>
            </div>
        </div>

        {% block content %}{% endblock %}

        <footer class="text-center text-[#e8dfd1] text-xs mt-10 opacity-70">
            A DFD project Â© 2025
        </footer>

        <script>
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.register("/static/service-worker.js")
            .catch((err) => console.log("SW registration failed:", err));
        }
        </script>

        <script>
        // Show Edit/Delete actions only for reviews that belong to this device (identity_pin in localStorage)
        (function () {
          try {
            const myPin = localStorage.getItem("identity_pin");
            if (!myPin) return;

            document.querySelectorAll("[data-review-identity-pin]").forEach((card) => {
              const reviewPin = card.getAttribute("data-review-identity-pin");
              if (reviewPin && reviewPin === myPin) {
                const actions = card.querySelector(".my-review-actions");
                if (actions) actions.classList.remove("hidden");
              }
            });

            // Fill hidden identity_pin fields for delete forms
            document.querySelectorAll(".identity-pin-field").forEach((inp) => {
              inp.value = myPin;
            });

            // Confirm before deleting
            document.addEventListener("submit", function (e) {
              const form = e.target.closest(".delete-review-form");
              if (!form) return;

              if (!confirm("Delete this review? This can't be undone.")) {
                e.preventDefault();
              }
            });

          } catch (err) {
            // ignore
          }
        })();
        </script>

    </div>
</body>
</html>
