<!DOCTYPE html>
{% import "cup_macros.html" as cups %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ title if title else "Coffee Ratings" }}</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Favicon -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/static/img/dfd_logo_64.png">

    <link rel="manifest" href="/static/manifest.json">
</head>

<body class="min-h-screen bg-[#4b3621] flex justify-center">
    <div class="w-full max-w-md px-4 pb-10">

        <!-- Top nav -->
        <div class="flex items-center justify-between mt-6 mb-6">
            <a href="/" class="text-[#f7f2e9] font-bold text-lg">Coffee Ratings</a>

            <div class="flex gap-4 text-sm">
                <a href="/venues" class="text-[#e8dfd1] hover:text-white">Venues</a>
                <a href="/reviews" class="text-[#e8dfd1] hover:text-white">Reviews</a>
                <a href="/reviews/new" class="text-[#e8dfd1] hover:text-white">Add</a>
            </div>
        </div>

        {% block content %}{% endblock %}

        <footer class="text-center text-[#e8dfd1] text-xs mt-10 opacity-70">
            A DFD project Â© 2025
        </footer>

        <script>
        if ("serviceWorker" in navigator) {
          navigator.serviceWorker.register("/static/service-worker.js")
            .catch((err) => console.log("SW registration failed:", err));
        }
        </script>

        <script>
        // Show Edit/Delete actions only for reviews that belong to this device (identity_pin in localStorage)
        (function () {
          try {
            const myPin = localStorage.getItem("identity_pin");
            if (!myPin) return;

            document.querySelectorAll("[data-review-identity-pin]").forEach((card) => {
              const reviewPin = card.getAttribute("data-review-identity-pin");
              if (reviewPin && reviewPin === myPin) {
                const actions = card.querySelector(".my-review-actions");
                if (actions) actions.classList.remove("hidden");
              }
            });

            // UI-only handlers for now
            document.addEventListener("click", function (e) {
              const el = e.target.closest("[data-action]");
              if (!el) return;

              e.preventDefault();

              const action = el.getAttribute("data-action");
              const card = el.closest("[data-review-id]");
              const reviewId = card ? card.getAttribute("data-review-id") : "";

              if (action === "edit") {
                alert("Edit review - coming soon. (Review ID: " + reviewId + ")");
              } else if (action === "delete") {
                alert("Delete review - coming soon. (Review ID: " + reviewId + ")");
              }
            });
          } catch (err) {
            // ignore
          }
        })();
        </script>

    </div>
</body>
</html>
